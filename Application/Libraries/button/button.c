/**
 * @file    button.c
 * @brief
 */

//==============================================================================
// Includes
//==============================================================================

#include "button.h"

//==============================================================================
// Private definitions
//==============================================================================

#define BTN_DEBOUNCE_TIME_MS    (300)

//==============================================================================
// Private macro
//==============================================================================

//==============================================================================
// Private typedef
//==============================================================================

//==============================================================================
// Extern variables
//==============================================================================

//==============================================================================
// Private function prototypes
//==============================================================================

//==============================================================================
// Private variables
//==============================================================================

//==============================================================================
// Private functions
//==============================================================================

//==============================================================================
// Exported functions
//==============================================================================

void Button_Read( Button_t *Btn )
{
  GPIO_PinState gpio_state;

  if(Btn->function_cb != NULL)
  {
    gpio_state = HAL_GPIO_ReadPin( Btn->Drv.Gpio, Btn->Drv.Pin );
    if( gpio_state != Btn->OldStatus )
    {
      Btn->Timer = xTaskGetTickCount() + BTN_DEBOUNCE_TIME_MS;
      Btn->OldStatus = gpio_state;
    }
    else if( ( Btn->OldStatus != Btn->CurrStatus ) && ( Btn->Timer > xTaskGetTickCount() ) )
    {
      Btn->CurrStatus =  Btn->OldStatus;
      Btn->function_cb( Btn->CurrStatus );
    }
  }
}
